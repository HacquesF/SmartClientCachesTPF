#!/bin/bash
if [ ! $# -eq 3 ]
then
   echo "Needs exactly 3 arguments. Usage: dockClient ServerIP ClientNumber NumberOfQueries"
   exit 1
fi

if [ $2 -lt 1 ]
then
   echo "Client numbers start at 1, careful not to exec more queries than we got"
   exit 1
fi
#Assign args
SERVIP=$1
CLIENTNB=$2
NBQUERIES=$3
(( END=$NBQUERIES*$CLIENTNB ))
(( START=$NBQUERIES*($CLIENTNB-1) ))

#Run the client
echo "Starting client $CLIENTNB"
docker run --name ldf-allclient$CLIENTNB -v $(pwd)/../zip/queries/scale1000_queries.json:/tmp/queries.json ldf-allclient http://$SERVIP:3000/scale1000 /tmp/queries.json -e $END -s $START
echo "Client $CLIENTNB as finished"

#Remove the container once it has executed
#Not using --rm to be sure not to be block by it on a second run
docker rm ldf-allclient$CLIENTNB
echo "Client $CLIENTNB removed"
